{"version":3,"sources":["../../src/pages/push-settings/push-settings.module.ts","../../src/pages/push-settings/push-settings.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { PushSettings } from './push-settings';\n\n@NgModule({\n  declarations: [\n    PushSettings,\n  ],\n  imports: [\n    IonicPageModule.forChild(PushSettings),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    PushSettings\n  ]\n})\nexport class PushSettingsModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/push-settings/push-settings.module.ts","import {Component} from '@angular/core';\nimport {NavParams, ViewController, ToastController, IonicPage} from 'ionic-angular';\nimport {Storage} from '@ionic/storage';\nimport {PushService} from '../../providers/push/push';\n\n@IonicPage()\n@Component({\n  templateUrl: 'push-settings.html',\n  selector: 'push-settings'\n})\nexport class PushSettings {\n\n  segments: any;\n\n  constructor( \n    public navParams: NavParams,\n    public storage: Storage,\n    public push: PushService,\n    public viewCtrl: ViewController,\n    public toastCtrl: ToastController\n    ) {\n    \n  }\n\n  ionViewWillEnter() {\n    this.getSegments()\n  }\n\n  // first get existing checked segments\n  getSegments() {\n  \n    this.storage.get( 'segments' ).then( segmentList => {\n\n      if(!segmentList) {\n        // no segments, so don't have to see if they are checked\n        this.segments = JSON.parse( window.localStorage.getItem('myappp') ).segments\n        this.storage.set( 'segments', this.segments )\n        return;\n      }\n\n      var checkedSegments = [];\n\n      for (var i = segmentList.length - 1; i >= 0; i--) {\n        if( segmentList[i].isChecked == true )\n          checkedSegments.push(segmentList[i].arn)\n      }\n\n      this.setSegments(checkedSegments)\n\n    })\n    \n  }\n\n  // get new segments, making sure existing checked ones stay checked, then save\n  setSegments( checkedSegments ) {\n\n    let newSegments = JSON.parse( window.localStorage.getItem('myappp') ).segments\n\n    for (var i = newSegments.length - 1; i >= 0; i--) {\n\n      if( checkedSegments.indexOf(newSegments[i].arn) >= 0 ) {\n        // segment is checked, resave it that way\n        newSegments[i].isChecked = true\n      }\n\n    }\n\n    this.segments = newSegments\n\n    this.storage.set( 'segments', newSegments )\n\n  }\n\n  toggleSegment( event, segment, segments ) {\n\n    console.log('toggleSegment', event)\n\n    this.storage.get( segment.arn ).then( subscriptionArn => {\n\n      if( subscriptionArn && segment.isChecked == false ) {\n        this.unsubscribe( subscriptionArn, segment.arn )\n      } else {\n        this.subscribe( segment.arn )\n      }\n\n      // update storage with toggle values\n      this.storage.set('segments', segments)\n\n    })\n\n  }\n\n  checkStatus( topicArn ) {\n\n    this.storage.get( topicArn ).then( res => {\n\n      console.log('isChecked', res)\n\n      if(res) {\n        return true\n      } else {\n        return false\n      }\n\n    })\n\n  }\n\n  subscribe( topicArn ) {\n\n    this.storage.get('deviceToken').then( token => {\n      this.push.subscribeToTopic( token, topicArn ).then( res => {\n        this.storage.set( topicArn, (<any>res).subscriptionArn )\n        this.presentToast( (<any>res).msg )\n      })\n    })\n\n  }\n\n  unsubscribe( subscriptionArn, topicArn ) {\n\n    // have to get subscriptionArn, then send to unsubscribe\n    this.push.unsubscribe( subscriptionArn ).then( res => {\n      this.storage.remove( topicArn )\n      this.presentToast( (<any>res).msg )\n    })\n\n  }\n\n  presentToast(msg) {\n\n    let toast = this.toastCtrl.create({\n      message: msg,\n      duration: 5000,\n      position: 'bottom'\n    });\n\n    toast.present();\n\n  }\n\n  dismiss() {\n    this.viewCtrl.dismiss();\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/push-settings/push-settings.ts"],"sourceRoot":""}